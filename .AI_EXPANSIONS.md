# AI Expansions – Instructions and rules

---

## Expansion type: Component Readiness job

Identified by the `-cr` variant

- **Filename pattern:** `*-cr-*.yaml`
- **Variant:** config variant name includes `-cr` (e.g. in `zz_generated_metadata.variant`)

### Expansion steps

**Files:** We expand the **4.21** config (baseline) to produce the **4.22** config.
- **Baseline:** `ci-operator/config/RedHatQE/interop-testing/RedHatQE-interop-testing-master__cnv-odf-ocp-4.21-lp-interop-cr.yaml` (variant: `cnv-odf-ocp-4.21-lp-interop-cr`)
- **Expansion:** `ci-operator/config/RedHatQE/interop-testing/RedHatQE-interop-testing-master__cnv-odf-ocp-4.22-lp-interop-cr.yaml` (variant: `cnv-odf-ocp-4.22-lp-interop-cr`)

### Changes

| Step | What changed | Notes |
|------|--------------|-------|
| 1    | Copied 4.21 config to new file `RedHatQE-interop-testing-master__cnv-odf-ocp-4.22-lp-interop-cr.yaml` (4.22 variant). | New `-cr` variant for OCP 4.22. |
| 2    | Updated release/version to 4.22 in all relevant places in the 4.22 file. | Top-level: `base_images.cli.name`, `base_images.upi-installer.name` (and any other `base_images.*.name` that hold OCP version), `images.build_args.OCP_VERSION`, `releases.latest.candidate.version`, test name `as:`, `zz_generated_metadata.variant`. Job env: see *Job-specific env vars to update (do change)* (e.g. `OCP_VERSION`). |
| 3    | Set release value in FIREWATCH_DEFAULT_JIRA_ADDITIONAL_LABELS: `4.21-lp*` → `4.22-lp*` for the 4.22 variant. | In `env.FIREWATCH_DEFAULT_JIRA_ADDITIONAL_LABELS`. |

### Critical: Filename and variant naming

If the **baseline** filename or variant includes **`-ocp4.21-lp-interop`** (no hyphen between `ocp` and the release), the **new file and variant must use the corrected form** with a hyphen: **`-ocp-4.22-lp-interop`** (break "ocp" and the release).  

> **Note:** If this is not implemented, the job will not be picked up by our automated reporting platforms.

Example: baseline `*__something-ocp4.21-lp-interop-cr.yaml` → expansion `*__something-ocp-4.22-lp-interop-cr.yaml`, and `zz_generated_metadata.variant` must use `...-ocp-4.22-lp-interop-cr` (not `...-ocp4.22-lp-interop-cr`).

### Excluded env vars (do not change)

We only bump **OCP/ocp** release and version fields. Job-specific env vars that carry **product** versions (e.g. CNV, ODF, operator channels) are left as in the baseline; the user verifies them in the checklist.

- **`CNV_VERSION`** — product version, not OCP release.
- **`ODF_VERSION_MAJOR_MINOR`** — product version (ODF), not OCP release.
- **`OPERATORS`** — product/operator definitions (channels, namespaces, etc.), not OCP release.
- **`ISTIO_SAMPLE_APP_VERSION`**, **`ISTIO_VERSION`**, **`KIALI_VERSION`** — product versions (service mesh), not OCP release.
- **`QUAY_VERSION`** — product version (Quay), not OCP release.
- **`base_images.cli.name`** — in **GitOps-lp-interop** job, do not bump; leave as in baseline (e.g. `"4.14"`). In **Serverless/Knative-lp-interop** job, do not bump; leave as in baseline (e.g. `"4.16"`). Job-specific / product-specific.

*(Add other product-version env vars here as needed.)*

### Job-specific env vars to update (do change)

Env vars that appear in job `steps.env` and **do** represent the OCP version — update these to the target release.

- **`OCP_VERSION`** — OCP version for the job.

*(Add other job-specific OCP-version env vars here as needed.)*

---

## User checklist (before considering the expansion done)

1. **Verify product release branch / operator channel, etc.**  
   Confirm that product-specific settings (e.g. operator channel, release branch, ODF/CNV versions) match the target release for this variant.

2. **Run generation locally.**  
   The user must run `make update` (or `make jobs` as needed). The model **never** generates or suggests these commands; the user performs them manually.

---

## Rules

- The model **never** generates or runs `make` commands (including `make jobs`, `make update`). The user must run them when configs or step-registry change.
